window.gameName="";window.timeoutId=0;window.gameHasBeenSaved=!1;$(init);
function init(){$(".container").on("click",".bid-container i",function(){var a=$(this);resetAutoSaveTimer();$(".editable").blur();a.hasClass("active")||(a.addClass("active"),a.siblings("i").removeClass("active"));var b=a.parentsUntil(".round").parent().find(".score.left"),a=a.parentsUntil(".round").parent().find(".score.right"),c=b.html();b.html(a.html());a.html(c);recalculateScores();highlightScores()}).on("click",".editable",function(){if(!$(this).hasClass("active")){var a=$(this).addClass("active"),
b=a.html();a.html("<input type='text' old-value='"+b+"' />").children("input").focus()}}).on("blur",".editable",function(){var a=$(this);if(a.hasClass("active")){resetAutoSaveTimer();var b=!1;if(""!==a.children("input").val())if(a.hasClass("score")){var c=parseInt(a.children("input").val(),10);0===c%5&&-180<=c&&180>=c?(a.removeClass("active").html(c),b=!0):a.removeClass("active").html(a.children("input").attr("old-value"))}else a.removeClass("active").html(a.children("input").val()),b=!0;else a.removeClass("active").html(a.children("input").attr("old-value"));
if(b&&!a.hasClass("bid")&&a.hasClass("score"))b=a.parentsUntil(".round").parent().find(".bid").html(),a.hasClass("left")&&a.parentsUntil(".round").parent().find("i.active").hasClass("left")||a.hasClass("right")&&a.parentsUntil(".round").parent().find("i.active").hasClass("right")?parseInt(a.html(),10)<b?(0<=parseInt(a.html(),10)&&a.parentsUntil(".round").parent().find(".score").not(a).not(".bid").html(180-parseInt(a.html(),10)),a.html(-1*b)):a.parentsUntil(".round").parent().find(".score").not(a).not(".bid").html(180-
parseInt(a.html(),10)):0<=parseInt(a.html(),10)?180-parseInt(a.html(),10)<b?a.parentsUntil(".round").parent().find(".score").not(a).not(".bid").html(-1*b):a.parentsUntil(".round").parent().find(".score").not(a).not(".bid").html(180-parseInt(a.html(),10)):(a.html(0),a.parentsUntil(".round").parent().find(".score").not(a).not(".bid").html(180)),recalculateScores(),highlightScores();else if(b&&a.hasClass("bid")&&a.hasClass("score")){var b=parseInt(a.parentsUntil(".round").parent().find(".score.left").html(),
10),c=parseInt(a.parentsUntil(".round").parent().find(".score.right").html(),10),d=parseInt(a.html(),10),e=a.parentsUntil(".round").parent().find("i.active").hasClass("right")?"right":"left";0===b&&0===c||("right"===e&&(180-b<d?a.parentsUntil(".round").parent().find(".score.right").html(-1*d):a.parentsUntil(".round").parent().find(".score.right").html(180-b)),"left"===e&&(180-c<d?a.parentsUntil(".round").parent().find(".score.left").html(-1*d):a.parentsUntil(".round").parent().find(".score.left").html(180-
c)));recalculateScores();highlightScores()}}}).on("keydown",".editable",function(a){13===a.which&&$(this).trigger("blur")}).on("click",".remove-button",function(){resetAutoSaveTimer();$(this).parentsUntil(".round").parent().slideUp(function(){$(this).remove();recalculateScores()})});$("#add-round-button").click(function(){resetAutoSaveTimer();var a=$("#templates .row.round").clone().css("display","none");$(".round-container").append(a);a.slideDown(function(){document.getElementById("footer-spacer").scrollIntoView()})});
$(".round-container").append($("#templates .row.round").clone());$(".round-container").sortable({start:function(){$(".editable").each(function(){$(this).trigger("blur")})},stop:function(){resetAutoSaveTimer();recalculateScores()}});$("#save").click(function(){""===window.gameName?$("#save-modal").modal("show"):saveScores()});$("#load").click(function(){$("#load-modal").modal("show")});$("#stats").click(function(){window.chartsAreReady&&(0<$(".round-container .round").size()?$("#stat-modal").modal("show"):
writeMessage("No rounds recorded!","red"))});$("#save-game-button").click(function(){checkForValidGameName("save")?($("#save-modal").modal("hide"),saveScores()):($("#duplicate-name-warning").slideDown(),$("#save-game-name").css("background","rgba(255, 0, 0, .15)"))});$("#load-game-button").click(function(){checkForValidGameName("load")?($("#load-modal").modal("hide"),loadScores()):($("#game-does-not-exist-warning").slideDown(),$("#load-game-name").css("background","rgba(255, 0, 0, .15)"))});$("#save-game-name, #load-game-name").on("focus keydown",
function(a){$(this).css("background","");a.which&&13===a.which&&$($(this).attr("enter-target")).click()});$("#save-modal, #load-modal").on("shown",function(){$(this).find("input.initial-focus").focus()});$("#save-modal, #load-modal").on("show",function(){$("#duplicate-name-warning, #game-does-not-exist-warning").css("display","none");$(this).find("#save-game-name, #load-game-name").css("background","");$(this).find("input.initial-focus").val("")});$(".tooltipped").tooltip();$("#chart-tab a").click(function(a){a.preventDefault();
a.stopPropagation();$(this).tab("show")});$("#score-by-round-tab").on("shown",function(a){a.stopPropagation();drawScoreByRoundChart()});$("#total-score-tab").on("shown",function(a){a.stopPropagation();drawTotalScoreChart()});$("#bid-tab").on("shown",function(a){a.stopPropagation();drawBidChart()});$("#miscellaneous-tab").on("shown",function(a){a.stopPropagation();drawMiscellaneousChart()});$("#stat-modal").on("shown",function(a){a.stopPropagation();$("#chart-tab li.active").trigger("shown")})};