function recalculateScores(){var a=0,c=0;$(".round-container .round").each(function(){var b=$(this);a+=parseInt(b.find(".score.left").html(),10);c+=parseInt(b.find(".score.right").html(),10)});$("#left-score").html(a);$("#right-score").html(c)}function highlightScores(){$(".editable.score").not(".bid").each(function(){var a=$(this);0>parseInt(a.html(),10)?a.css("color","red"):a.css("color","")})}
function saveScores(a){var c=a||"Game saved!";a={};var b=[];$(".round-container .round").each(function(){var a=$(this);a.parent().is("#templates")||b.push({left:a.find(".score.left").html(),bid:a.find(".score.bid").html(),right:a.find(".score.right").html(),"bid-direction":a.find(".icon-circle-arrow-left").is(".active")?"left":"right"})});a.scores=b;a.gameName=window.gameName;a.host=window.location.host;a.team1Name=$("#team-1-name").html();a.team2Name=$("#team-2-name").html();$.ajax({type:"POST",
url:"save-game.php",data:a,success:function(a){a.success?(writeMessage(c,"green"),window.gameHasBeenSaved=!0):($("#error-message-container").html(a.message),$("#error-modal").modal("show"))},error:function(a){a.message?$("#error-message-container").html(a.message):$("#error-message-container").html("An error occured while attempting to connect to the server.  Please try again.");$("#error-modal").modal("show")},dataType:"json"})}
function loadScores(a){var c=a||'Game "'+window.gameName+'" loaded.';a={};a.gameName=window.gameName;a.host=window.location.host;$.ajax({type:"POST",url:"load-game.php",data:a,success:function(a){if(a.success){writeMessage(c,"green");window.gameHasBeenSaved=!0;a=a.data;$(".round-container").html("");var e=!1;a.forEach(function(a){e||($("#team-1-name").html(a.team1Name),$("#team-2-name").html(a.team2Name),e=!0);var b=$("#templates .row.round").clone().css("display","none");b.find(".score.left").html(a.left);
b.find(".score.bid").html(a.bid);b.find(".score.right").html(a.right);"right"===a.bidDirection&&b.find(".bid-container i").toggleClass("active");$(".round-container").append(b.css("display",""))});recalculateScores();highlightScores()}else $("#error-message-container").html(a.message),$("#error-modal").modal("show")},error:function(a){a.message?$("#error-message-container").html(a.message):$("#error-message-container").html("An error occured while attempting to connect to the server.  Please try again.");
$("#error-modal").modal("show")},dataType:"json"})}
function checkForValidGameName(a){window.nameIsValid=!1;window.timeoutId=0;var c={};"save"===a&&""===window.gameName&&(window.gameName=$("#save-game-name").val());c.gameName="save"===a?window.gameName:$("#load-game-name").val();c.host=window.location.host;$.ajax({type:"POST",url:"check-name.php",data:c,success:function(b){b.success?(window.nameIsValid=b.nameIsValid?"save"===a:"save"!==a,window.nameIsValid&&"save"!==a&&(window.gameName=$("#load-game-name").val())):($("#error-message-container").html(b.message),
$(".modal").modal("hide"),$("#error-modal").modal("show"))},error:function(a){a.message?$("#error-message-container").html(a.message):$("#error-message-container").html("An error occured while attempting to connect to the server.  Please try again.");$("#error-modal").modal("show")},dataType:"json",async:!1});return window.nameIsValid}
function writeMessage(a,c){var b=c||"green";$("#alert-title-container").stop().fadeOut(function(){$(this).html(a).css({color:b,fontSize:"25px"}).fadeIn();setTimeout(function(){$("#alert-title-container").fadeOut(function(){var a=""===window.gameName?"Rookkeeper":window.gameName;$(this).html(a).css({color:"black",fontSize:""}).fadeIn()})},2E3)})}
function resetAutoSaveTimer(){window.gameHasBeenSaved&&(window.clearTimeout(window.timeoutId),window.timeoutId=window.setTimeout(function(){saveScores("All changes saved.")},5E3))}
function drawScoreByRoundChart(){var a=[["Round",$("#team-1-name").html(),"bid",$("#team-2-name").html()]],c=1;$(".round-container .round").each(function(){var b=$(this);a.push([c,parseInt(b.find(".score.left").html(),10),parseInt(b.find(".score.bid").html(),10),parseInt(b.find(".score.right").html(),10)]);c++});var b=google.visualization.arrayToDataTable(a);(new google.visualization.AreaChart(document.getElementById("score-by-round-chart"))).draw(b,{title:"Score by round",hAxis:{title:"Round"},vAxis:{title:"Score"}})}
function drawTotalScoreChart(){var a=[["Round",$("#team-1-name").html(),"bid",$("#team-2-name").html()]],c=0,b=0,e=1;$(".round-container .round").each(function(){var d=$(this);a.push([e,c+=parseInt(d.find(".score.left").html(),10),parseInt(d.find(".score.bid").html(),10),b+=parseInt(d.find(".score.right").html(),10)]);e++});var d=google.visualization.arrayToDataTable(a);(new google.visualization.LineChart(document.getElementById("total-score-chart"))).draw(d,{title:"Total score",hAxis:{title:"Round"},
vAxis:{title:"Score"}})}
function drawBidChart(){var a=0,c=0,b=0,e=0;$(".round-container .round").each(function(){var d=$(this);d.find("i.left").is(".active")?(a++,0>parseInt(d.find(".score.left").html(),10)&&b++):(c++,0>parseInt(d.find(".score.right").html(),10)&&e++)});var d=google.visualization.arrayToDataTable([["Team","Bids taken"],[$("#team-1-name").html(),a],[$("#team-2-name").html(),c]]);(new google.visualization.PieChart(document.getElementById("bid-chart-1"))).draw(d,{title:"Bids taken by team",titleTextStyle:{fontSize:14},
legend:{position:"top"},slices:{"0":{color:"#383838"},1:{color:"#AAA",textStyle:{color:"black"}}}});var d=google.visualization.arrayToDataTable([["Bid result","Successful Bids"],["Successful bids",a-b],["Failed bids",b]]),r={title:"Outcome of bids taken by "+$("#team-1-name").html(),titleTextStyle:{fontSize:14},legend:{position:"top"},colors:["green","red"]};(new google.visualization.PieChart(document.getElementById("bid-chart-2"))).draw(d,r);d=google.visualization.arrayToDataTable([["Bid result",
"Successful Bids"],["Successful bids",c-e],["Failed bids",e]]);r={title:"Outcome of bids taken by "+$("#team-2-name").html(),titleTextStyle:{fontSize:14},legend:{position:"top"},colors:["green","red"]};(new google.visualization.PieChart(document.getElementById("bid-chart-3"))).draw(d,r)}
function drawMiscellaneousChart(){var a=0,c=0,b=0,e=0,d=0,r=0,H=0,A=0,B=0,s=0,t=0,u=180,v=180,C=[],D=[],E=[],F=[],y=[],z=[],h=0,j=0,k=0,l=0,m=0,n=0,p=$(".round-container .round");p.each(function(){var q=$(this),f=parseInt(q.find(".score.left").html(),10),h=parseInt(q.find(".score.bid").html(),10),g=parseInt(q.find(".score.right").html(),10),q=q.find(".bid-container i.left").is(".active")?"left":"right";a+=f;c+=g;b+=f+g;"left"===q?(e++,A+=h,0>f&&r++,C.push(f),F.push(g),y.push(f),z.push(g)):(d++,B+=
h,0>g&&H++,D.push(g),E.push(f),y.push(g),z.push(f));f>s&&(s=f);g>t&&(t=g);f<u&&(u=f);g<v&&(v=g)});var w=0,x=0,G=0;0<p.size()?(w=0<e?Math.round(A/e):"-",x=0<d?Math.round(B/d):"-"):x=w="-";C.forEach(function(a){h+=a});E.forEach(function(a){k+=a});D.forEach(function(a){j+=a});F.forEach(function(a){l+=a});y.forEach(function(a){m+=a});z.forEach(function(a){n+=a});h=Math.round(h/C.length);j=Math.round(j/D.length);k=Math.round(k/E.length);l=Math.round(l/F.length);m=Math.round(m/y.length);n=Math.round(n/
z.length);isNaN(h)&&(h="-");isNaN(k)&&(k="-");isNaN(j)&&(j="-");isNaN(l)&&(l="-");isNaN(m)&&(m="-");isNaN(n)&&(n="-");G="-"!==w&&"-"!==x?Math.round((w+x)/2):"-";a=Math.round(a/p.size());c=Math.round(c/p.size());b=Math.round(b/(2*p.size()));p="\t\t<table class='table table-striped' id='averages-table'>\t\t\t<thead>\t\t\t\t<tr>\t\t\t\t\t<th></th>\t\t\t\t\t<th>Average points/round</th>\t\t\t\t\t<th>Average bid</th>\t\t\t\t\t<th><div class='tooltipped' data-placement='top' title='the average number of points scored in any round in which the bid was won'>Average points/bid winning round</div></th>\t\t\t\t\t<th><div class='tooltipped' data-placement='top' title='the average number of points scored in any round in which the bid was lost'</div>Average points/bid losing round</th>\t\t\t\t\t<th><div class='tooltipped' data-placement='top' title='the most amount of points scored in any single round'>Best round</div></th>\t\t\t\t\t<th><div class='tooltipped' data-placement='top' title='the least amount of points scored in any single round'>Worst round</div></th>\t\t\t\t</tr>\t\t\t</thead>\t\t\t<tbody>\t\t\t\t<tr>\t\t\t\t\t<td><b>"+
$("#team-1-name").html()+"</b></td>\t\t\t\t\t<td>"+a+"</td>\t\t\t\t\t<td>"+w+"</td>\t\t\t\t\t<td>"+h+"</td>\t\t\t\t\t<td>"+k+"</td>\t\t\t\t\t<td>"+s+"</td>\t\t\t\t\t<td>"+u+"</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td><b>"+$("#team-2-name").html()+"</b></td>\t\t\t\t\t<td>"+c+"</td>\t\t\t\t\t<td>"+x+"</td>\t\t\t\t\t<td>"+j+"</td>\t\t\t\t\t<td>"+l+"</td>\t\t\t\t\t<td>"+t+"</td>\t\t\t\t\t<td>"+v+"</td>\t\t\t\t</tr>\t\t\t\t<tr>\t\t\t\t\t<td><b>Overall</b></td>\t\t\t\t\t<td>"+b+"</td>\t\t\t\t\t<td>"+G+
"</td>\t\t\t\t\t<td>"+m+"</td>\t\t\t\t\t<td>"+n+"</td>\t\t\t\t\t<td>"+(s>t?s:t)+"</td>\t\t\t\t\t<td>"+(u<v?u:v)+"</td>\t\t\t\t</tr>\t\t\t</tbody>\t\t</table>";$("#miscellaneous-chart").html(p).find(".tooltipped").tooltip()};